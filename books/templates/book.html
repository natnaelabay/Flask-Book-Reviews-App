{% extends "base.html" %}

{% block title %} Book {% endblock %}

{% block head %}

{{ super() }}
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.3/css/all.css"
    integrity="sha384-SZXxX4whJ79/gErwcOYf+zWLeJdY/qpuqC4cAa9rOGUstPomtqpuNWT9wdPEn2fk" crossorigin="anonymous">

{% endblock %}


{% block content %}
<style>
    body {
        font-size: 1.5rem;
    }

    .container {
        font-family: Poppins;
        font-weight: 200;
    }

    .rating-wrapper {
        color: white;
    }

    .rating-showcase {
        color: white;
    }

    .fa-star {
        color: white;
    }

    .rating-wrapper:hover {
        cursor: pointer;
    }

    .rating-showcase:hover {
        cursor: pointer;
    }

    .bg-red {
        color: red;
    }

    img {
        height: 6rem;
    }

    .contact {
        display: flex;
        flex-direction: column;
        justify-content: center;
    }

    .r-card {
        position: relative;
        width: 90%;
        margin-top: 5rem;
        padding: 1rem 1.8rem;
        border-radius: .3rem;
        color: white;
        background-color: #5A5A5A;
    }

    .r-card p {
        font-size: 1.3rem;
    }

    .p-img-wrapper {
        height: 4rem;
        border-radius: 50%;
    }

    .p-img {
        position: absolute;
        top: 0;
        left: 0;
        transform: translateX(-50%) translateY(-50%);
    }

    .txt-area {
        font-size: 1rem;
        width: 100%;
        padding: 2rem;
        height: 2rem;
        color: #fff;
        background: rgb(107, 107, 107);
    }

    .txt-area::placeholder {
        color: #fff;
    }

    .r-btn {
        padding: 1rem;
        font-size: 1rem;
        transition: all .3s;
        box-shadow: none;
    }

    .r-btn:hover {
        box-shadow: none;
        background-color: rgb(47, 47, 47);

    }
</style>

<div class="container">

    {% if book_info %}

    <div class="row">
        <div class="col-9">
            <div class="row">
                <div class="col-3">
                    <img src="{{ url_for('static' , filename='images/book-svg.png')}}" alt="">
                </div>
                <div class="text-white ml-n5  col-8 contact">
                    <h1>{{ book_info.title }}</h1>
                    <div class="row">
                        <div class="col-6" style="font-size: 1rem;">
                            <p>By: {{ book_info.author }}</p>
                        </div>
                        <div class="ml-n5 col-4" style="font-size: 1rem;">
                            <p>pub date: {{ book_info.year }}</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-3 text-right contact">

            <!-- <div class="rating-showcase">
                {% if review %}
                {% for i in range(5) %}
                {% if i < book_info.rating_star %} <span id="{{i + 1}}" class="fa fa-star bg-red"></span>
                    {% else %}
                    <span id="{{i + 1}}" class="fa fa-star "></span>
                    {% endif %}
                    {% endfor %}
                    <h4 class="text-left d-inline-block ml-3 rating-average">{{book_info.rating}}</h4>
                    {% else%}
                    {% for i in range(5) %}
                    <span class="fa fa-star "></span>
                    {% endfor %}
                    <h4 class="text-left d-inline-block ml-3 rating-average">0</h4>
                {% endif %}

            </div>  -->
            <div class="rating-showcase">
                {% if rating %}
                {% for i in range(5) %}
                {% if i < rating.star_rating %} <span id="{{i + 1}}" class="fa fa-star bg-red"></span>
                    {% else %}
                    <span id="{{i + 1}}" class="fa fa-star "></span>
                    {% endif %}
                    {% endfor %}
                    <h4 class="text-left d-inline-block ml-3 rating-average">{{rating.avg_rating}}</h4>
                    {% else %}
                    {% for i in range(5) %}
                    <span class="fa fa-star "></span>
                    {% endfor %}
                    <h4 class="text-left d-inline-block ml-3 rating-average">0</h4>
                    {% endif%}
            </div>
            <!-- <span id="3" class="fa fa-star bg-red"></span>
            <span id="4" class="fa fa-star"></span>
            <span id="5" class="fa fa-star"></span> -->
        </div>
    </div>


    <div class="mx-auto my-4 card bg-rate ">
        <div class="text-center py-1">
            <p style="font-size: 1.2rem;">Total Ratings:
                {%if rating %}{{rating.total_count}}{% else %}0{% endif %}
            </p>
            <p style="font-size: 1.2rem;">Average Rating from API:
                {%if rating %}{{rating.api_avg}}{% else %}No data from API{% endif %}
            </p>
        </div>
        {% if rating %}
        <div class="row mx-4">

            <div class="side">
                <div>5 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-5" style="width: {{ rating.five_avg}}%;"></div>
                </div>
            </div>
            <div class="side right">
                <div>{{ rating.five}}</div>
            </div>
            <div class="side">
                <div>4 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-4" style="width: {{ rating.four_avg}}%;"></div>
                </div>
            </div>
            <div class="side right">
                <div>{{rating.four}}</div>
            </div>
            <div class="side">
                <div>3 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-3" style="width: {{ rating.three_avg}}%;"></div>
                </div>
            </div>
            <div class="side right">
                <div>{{ rating.three }}</div>
            </div>
            <div class="side">
                <div>2 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-2" style="width: {{ rating.two_avg}}%;"></div>
                </div>
            </div>
            <div class="side right">
                <div>{{rating.two}}</div>
            </div>
            <div class="side">
                <div>1 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-1" style="width: {{ rating.one_avg}}%;"></div>
                </div>
            </div>
            <div class="side right">
                <div>{{ rating.one }}</div>
            </div>
        </div>

        {% else %}

        <div class="row mx-4">
            <div class="side">
                <div>5 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-5"></div>
                </div>
            </div>
            <div class="side right">
                <div>0</div>
            </div>
            <div class="side">
                <div>4 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-4"></div>
                </div>
            </div>
            <div class="side right">
                <div>0</div>
            </div>
            <div class="side">
                <div>3 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-3"></div>
                </div>
            </div>
            <div class="side right">
                <div>0</div>
            </div>
            <div class="side">
                <div>2 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-2"></div>
                </div>
            </div>
            <div class="side right">
                <div>0</div>
            </div>
            <div class="side">
                <div>1 star</div>
            </div>
            <div class="middle">
                <div class="bar-container">
                    <div class="bar-1"></div>
                </div>
            </div>
            <div class="side right">
                <div>0</div>
            </div>
        </div>
        {% endif %}

    </div>
    <hr class="bg-white">
    <style>
        .bg-rate {
            width: 60%;
            font-size: 1rem;
            background: rgb(100, 99, 99);
        }

        /* Three column layout */
        .side {
            float: left;
            width: 15%;
            margin-top: 10px;
        }

        .middle {
            margin-top: 10px;
            float: left;
            width: 70%;
        }

        /* Place text to the right */
        .right {
            text-align: right;
        }

        /* Clear floats after the columns */
        .row:after {
            content: "";
            display: table;
            clear: both;
        }

        /* The bar container */
        .bar-container {
            width: 100%;
            background-color: #e7e7e7;
            text-align: center;
            color: white;
        }

        /* Individual bars */
        .bar-5 {
            width: 0%;
            height: 18px;
            background-color: #4CAF50;
        }

        .bar-4 {
            width: 0%;
            height: 18px;
            background-color: #2196F3;
        }

        .bar-3 {
            width: 0%;
            height: 18px;
            background-color: #00bcd4;
        }

        .bar-2 {
            width: 0%;
            height: 18px;
            background-color: #ff9800;
        }

        .bar-1 {
            width: 0%;
            height: 18px;
            background-color: #f44336;
        }
    </style>


    <h2 class="text-white my-4">Submit A review</h2>
    <div class="w-100 mt-3">
        <div class="rating-wrapper my-4">
            <span id="1" class="fa star fa-star" style="color: red;"></span>
            <span id="2" class="fa star fa-star"></span>
            <span id="3" class="fa star fa-star"></span>
            <span id="4" class="fa star fa-star"></span>
            <span id="5" class="fa star fa-star"></span>
            <h4 class="text-left d-inline-block ml-3 rating-count">1</h4>
        </div>
        <form action="/submit-review" method="POST" class="r-form" id="r-form">
            <div class="row">
                <div class="col-10">
                    <input type="text" placeholder="Submit text" name="rating_text" class="txt-area">
                </div>
                <div class="col-2 d-flex justify-content-center flex-column ">
                    <input type="submit" value="Submit" class="r-btn d-inline-block btn btn-primary">
                </div>
            </div>
            <input type="text" placeholder="" id="review_isbn" class="d-none" name="review_isbn"
                value="{{book_info.isbn}}">
            <input type="text" placeholder="" id="rating_count" class="d-none" name="rating_count">
        </form>
    </div>


    {% for review in rating %}
    <div class=" r-card ">
        <div class="d-inline my-auto">
            <div class="p-img">
                <img src="{{review.usr_profile }}" alt="" class="p-img-wrapper">
            </div>
            <div class="row">
                <div class="col">
                    <h2>{{review.f_name | capitalize}} {{ review.l_name | capitalize }}</h2>
                </div>
                <div class="col">
                    <h6 class="text-right">rating: {{ review.rate_count }} </h6>
                </div>
            </div>
            <p class="text-white">{{ review.rate_desc }}</p>
        </div>
    </div>
    {% else %}
    <h1>No reviews yet! care to give one? </h1>
    {% endfor %}


    {% else %}
    <h1>No such thing as a book</h1>
    {% endif %}

</div>



<script>
    const rating = document.querySelector(".rating-wrapper")
    const ratingCount = document.querySelector(".rating-count")
    const ratingInput = document.querySelector("#rating_count")
    const r_form = document.querySelector("#r-form")
    const rating_stars = document.querySelectorAll(".star")
    let cur = false;
    let not = 0;
    let ids = ["1", "2", "3", "4", "5"];
    rating.addEventListener("mouseover", e => {
        if (ids.includes(e.target.id)) {
            for (let i = 0; i < parseInt(e.target.id); i++) {
                rating_stars[i].style.color = "red"
            }
            not = parseInt(e.target.id)
        }
    });
    rating.addEventListener("mouseout", e => {
        for (let i = (cur == false) ? 1 : cur; i < 5; i++) {
            rating_stars[i].style.color = "white";
        }
    });
    rating_stars.forEach(r => {
        r.addEventListener("click", e => {
            for (let i = 0; i < parseInt(e.target.id); i++) {
                rating_stars[i].style.color = "red";
            }
            for (let i = parseInt(e.target.id); i < 5; i++) {
                rating_stars[i].style.color = "white";
            }
            cur = e.target.id;
            ratingCount.innerHTML = cur
            ratingInput.value = cur
            console.log(cur)
        })
    });
</script>



{% endblock %}